<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>KASUR - Kampung Surveilans</title>
    
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#0f172a">
    <meta name="application-name" content="KASUR">
    <meta name="apple-mobile-web-app-title" content="KASUR">

    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 512 512'%3E%3Cdefs%3E%3ClinearGradient id='bgCheck' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3E%3Cstop offset='0%25' style='stop-color:%230f172a;stop-opacity:1' /%3E%3Cstop offset='100%25' style='stop-color:%231e293b;stop-opacity:1' /%3E%3C/linearGradient%3E%3ClinearGradient id='glow' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3E%3Cstop offset='0%25' style='stop-color:%2338bdf8;stop-opacity:1' /%3E%3Cstop offset='100%25' style='stop-color:%23818cf8;stop-opacity:1' /%3E%3C/linearGradient%3E%3Cfilter id='blurMe'%3E%3CfeGaussianBlur in='SourceGraphic' stdDeviation='5' /%3E%3C/filter%3E%3Cfilter id='innerShadow'%3E%3CfeOffset dx='0' dy='4' /%3E%3CfeGaussianBlur stdDeviation='10' result='offset-blur' /%3E%3CfeComposite operator='out' in='SourceGraphic' in2='offset-blur' result='inverse' /%3E%3CfeFlood flood-color='black' flood-opacity='0.5' result='color' /%3E%3CfeComposite operator='in' in='color' in2='inverse' result='shadow' /%3E%3CfeComposite operator='over' in='shadow' in2='SourceGraphic' /%3E%3C/filter%3E%3C/defs%3E%3Crect width='512' height='512' rx='120' fill='url(%23bgCheck)'/%3E%3Crect x='40' y='40' width='432' height='432' rx='100' fill='none' stroke='url(%23glow)' stroke-width='8' opacity='0.5'/%3E%3Ccircle cx='256' cy='256' r='120' fill='url(%23glow)' filter='url(%23blurMe)' opacity='0.4' /%3E%3Cpath d='M360 232H280V152C280 138.7 269.3 128 256 128C242.7 128 232 138.7 232 152V232H152C138.7 232 128 242.7 128 256C128 269.3 138.7 280 152 280H232V360C232 373.3 242.7 384 256 384C269.3 384 280 373.3 280 360V280H360C373.3 280 384 269.3 384 256C384 242.7 373.3 232 360 232Z' fill='white' filter='url(%23innerShadow)'/%3E%3C/svg%3E">
    
    <link rel="apple-touch-icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 512 512'%3E%3Crect width='512' height='512' fill='%230f172a'/%3E%3Cdefs%3E%3ClinearGradient id='glow' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3E%3Cstop offset='0%25' style='stop-color:%2338bdf8;stop-opacity:1' /%3E%3Cstop offset='100%25' style='stop-color:%23818cf8;stop-opacity:1' /%3E%3C/linearGradient%3E%3C/defs%3E%3Crect width='512' height='512' rx='120' fill='%230f172a'/%3E%3Cpath d='M360 232H280V152C280 138.7 269.3 128 256 128C242.7 128 232 138.7 232 152V232H152C138.7 232 128 242.7 128 256C128 269.3 138.7 280 152 280H232V360C232 373.3 242.7 384 256 384C269.3 384 280 373.3 280 360V280H360C373.3 280 384 269.3 384 256C384 242.7 373.3 232 360 232Z' fill='white'/%3E%3C/svg%3E">

    <link rel="manifest" href="data:application/manifest+json;base64,eyJuYW1lIjoiS0FTVVIgKGVtcHVuZyBTdXJ2ZWlsYW5zKSIsInNob3J0X25hbWUiOiJLQVNVUiIsImRlc2NyaXB0aW9uIjoiU2lzdGVtIEluZm9ybWFzaSBLZXNlaGF0YW4gVGVyaW50ZWdyYXNpIiwic3RhcnRfdXJsIjoiLiIsImRpc3BsYXkiOiJzdGFuZGFsb25lIiwiYmFja2dyb3VuZF9jb2xvciI6IiMwZjE3MmEiLCJ0aGVtZV9jb2xvciI6IiMwZjE3MmEiLCJpY29ucyI6W3sic3JjIjoiZGF0YTppbWFnZS9zdmcreG1sOy4uLiIsInR5cGUiOiJpbWFnZS9zdmcreG1sIiwic2l6ZXMiOiIxNDR4MTQ0IDE5MngxOTIgNTEyeDUxMiIs" id="manifestLink">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* RESET & VARIABLES */
        :root {
            /* Warna Palet Baru yang Lebih Hidup */
            --primary-gradient: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            
            --accent-color: #007AFF;
            --bg-body: #EEF2F6;
            
            --card-white: #FFFFFF;
            --text-dark: #1e293b;
            --text-light: #64748b;
            
            --shadow-card: 0 10px 15px -3px rgba(0, 0, 0, 0.05), 0 4px 6px -2px rgba(0, 0, 0, 0.025);
            --shadow-hover: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            
            --radius: 20px;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            -webkit-tap-highlight-color: transparent;
        }

        html, body {
            height: 100%; /* Fix bug garis loading */
        }

        body {
            background-color: var(--bg-body);
            background-image: radial-gradient(#cbd5e1 1px, transparent 1px);
            background-size: 24px 24px;
            color: var(--text-dark);
            min-height: 100vh;
            /* Mencegah scroll saat splash screen tampil */
            overflow: hidden; 
        }

        body.loaded {
            overflow: auto;
            height: auto;
        }

        /* --- INSTALL BANNER STYLES --- */
        .install-banner {
            display: none; /* Default hidden */
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            width: 90%;
            max-width: 400px;
            background: rgba(15, 23, 42, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 15px 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            z-index: 999;
            align-items: center;
            justify-content: space-between;
            transition: transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            border: 1px solid rgba(255,255,255,0.1);
        }

        .install-banner.show {
            display: flex;
            transform: translateX(-50%) translateY(0);
        }

        .install-content {
            display: flex;
            align-items: center;
            gap: 15px;
            color: white;
        }

        .install-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #38bdf8, #818cf8);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
        }

        .install-text h4 { font-size: 0.95rem; margin-bottom: 2px; }
        .install-text p { font-size: 0.75rem; opacity: 0.7; }

        .install-btn {
            background: white;
            color: #0f172a;
            border: none;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.85rem;
            cursor: pointer;
            transition: transform 0.2s;
        }
        .install-btn:active { transform: scale(0.95); }
        .close-install { 
            position: absolute; 
            top: -10px; right: -10px; 
            background: #ef4444; 
            color: white; 
            width: 24px; height: 24px; 
            border-radius: 50%; 
            display: flex; align-items: center; justify-content: center;
            cursor: pointer; font-size: 12px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }


        /* --- SPLASH SCREEN STYLES (OPENING) --- */
        .splash-screen {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            /* Latar belakang Biru Gelap (Navy) yang tenang dan profesional */
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            z-index: 99999; /* Z-Index sangat tinggi */
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            transition: opacity 0.5s ease-in-out, visibility 0.5s ease-in-out;
            width: 100vw;
            height: 100vh;
        }

        .splash-screen.hide {
            opacity: 0;
            visibility: hidden;
            pointer-events: none;
        }

        .splash-content {
            text-align: center;
            color: white; /* Teks putih di latar gelap */
            position: relative;
            z-index: 2;
        }

        /* Icon Container - Update Style: Glassy Dark */
        .splash-icon-box {
            width: 110px;
            height: 110px;
            /* Efek kaca transparan putih tipis */
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 30px; /* Lebih rounded seperti iOS */
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 25px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4); 
            animation: zoomIn 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            position: relative;
            overflow: hidden;
        }
        
        /* Shine effect pada icon */
        .splash-icon-box::after {
            content: '';
            position: absolute;
            top: -50%; left: -50%;
            width: 200%; height: 200%;
            background: linear-gradient(to right, transparent, rgba(255,255,255,0.1), transparent);
            transform: rotate(45deg);
            animation: shine 3s infinite;
        }

        .splash-icon {
            font-size: 50px;
            /* Ikon Putih dengan efek Glow Biru Muda */
            color: #ffffff;
            filter: drop-shadow(0 0 10px rgba(56, 189, 248, 0.5));
            animation: heartbeat 2s infinite;
        }

        .splash-title {
            font-size: 2.2rem; 
            font-weight: 800;
            margin-bottom: 5px;
            background: linear-gradient(to right, #ffffff, #94a3b8);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            letter-spacing: 0.5px;
            opacity: 0;
            transform: translateY(20px);
            animation: fadeUp 0.8s ease forwards 0.3s;
        }

        .splash-subtitle {
            font-size: 0.9rem;
            color: #94a3b8; /* Abu-abu kebiruan (Slate-400) yang elegan */
            opacity: 0;
            font-weight: 500;
            transform: translateY(20px);
            animation: fadeUp 0.8s ease forwards 0.5s;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        /* Loading Dots */
        .loading-dots {
            display: flex;
            gap: 8px;
            margin-top: 50px;
            justify-content: center;
            opacity: 0;
            animation: fadeIn 0.5s ease forwards 0.8s;
        }

        .dot {
            width: 8px;
            height: 8px;
            background: #38bdf8; /* Biru Langit cerah untuk kontras */
            border-radius: 50%;
            box-shadow: 0 0 15px rgba(56, 189, 248, 0.6);
            animation: bounceDot 1.4s infinite ease-in-out both;
        }

        .dot:nth-child(1) { animation-delay: -0.32s; opacity: 0.6; }
        .dot:nth-child(2) { animation-delay: -0.16s; opacity: 0.8; }
        .dot:nth-child(3) { opacity: 1; }

        @keyframes zoomIn {
            from { transform: scale(0); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        @keyframes heartbeat {
            0% { transform: scale(1); }
            10% { transform: scale(1.1); }
            20% { transform: scale(1); }
            30% { transform: scale(1.1); }
            50% { transform: scale(1); }
        }

        @keyframes fadeUp {
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes fadeIn {
            to { opacity: 1; }
        }
        
        @keyframes shine {
            0% { left: -100%; top: -100%; }
            50% { left: 200%; top: 200%; }
            100% { left: 200%; top: 200%; }
        }

        @keyframes bounceDot {
            0%, 80%, 100% { transform: scale(0); }
            40% { transform: scale(1); }
        }

        /* --- END SPLASH SCREEN --- */


        /* CONTAINER */
        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* HEADER MODERN */
        .header-wrapper {
            background: var(--primary-gradient);
            border-radius: 0 0 30px 30px; 
            padding: 40px 20px 80px 20px; 
            margin-bottom: -35px; 
            text-align: center;
            color: white;
            position: relative;
            overflow: hidden;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
        }

        .header-bg-circle {
            position: absolute;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
        }
        .circle-1 { width: 200px; height: 200px; top: -50px; left: -50px; }
        .circle-2 { width: 150px; height: 150px; bottom: 10px; right: -20px; }

        .header-content {
            position: relative;
            z-index: 2;
        }

        .header h1 {
            font-size: 2.5rem;
            font-weight: 800;
            margin-bottom: 5px;
            letter-spacing: -1px;
        }

        .header p {
            font-size: 1rem;
            opacity: 0.9;
            font-weight: 300;
        }

        /* SEARCH BAR */
        .search-container {
            max-width: 500px;
            margin: 0 auto 40px auto; 
            position: relative;
            z-index: 10;
        }

        .search-box {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 50px;
            padding: 12px 25px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1); 
            display: flex;
            align-items: center;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            border: 1px solid rgba(255,255,255,0.5);
        }
        
        .search-box:focus-within {
            transform: translateY(-2px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
            border-color: var(--accent-color);
        }

        .search-box i {
            color: #94a3b8;
            margin-right: 15px;
        }

        .search-box input {
            width: 100%;
            border: none;
            background: transparent;
            padding: 5px 0;
            font-size: 1rem;
            color: var(--text-dark);
            outline: none;
        }

        /* GRID LAYOUT */
        .menu-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
            padding: 0 5px;
        }

        /* CARD STYLES */
        .health-card {
            background: var(--card-white);
            border-radius: var(--radius);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            text-decoration: none;
            color: inherit;
            box-shadow: var(--shadow-card);
            padding: 20px 15px; 
            text-align: center;
            aspect-ratio: 1/1;
            position: relative;
            overflow: hidden;
            border: 2px solid transparent; 
            
            -webkit-tap-highlight-color: transparent;
            user-select: none;
        }

        .health-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-hover);
            border-color: transparent; 
        }

        .card-icon {
            width: 55px; 
            height: 55px;
            border-radius: 16px; 
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 15px;
            font-size: 24px;
            color: white;
            transition: transform 0.3s ease;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }

        .health-card:hover .card-icon {
            transform: scale(1.1) rotate(5deg);
        }

        .card-content h3 {
            font-size: 1.05rem;
            font-weight: 700;
            margin-bottom: 5px;
            color: var(--text-dark);
        }

        .card-content p {
            font-size: 0.8rem;
            color: var(--text-light);
            line-height: 1.4;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        /* COLOR UTILITIES */
        .campak { background: linear-gradient(135deg, #FF416C, #FF4B2B); box-shadow: 0 4px 15px rgba(255, 75, 43, 0.3); }
        .difteri { background: linear-gradient(135deg, #F7971E, #FFD200); box-shadow: 0 4px 15px rgba(247, 151, 30, 0.3); }
        .afp { background: linear-gradient(135deg, #11998e, #38ef7d); box-shadow: 0 4px 15px rgba(56, 239, 125, 0.3); }
        .tetanus { background: linear-gradient(135deg, #8E2DE2, #4A00E0); box-shadow: 0 4px 15px rgba(74, 0, 224, 0.3); }
        .pertusis { background: linear-gradient(135deg, #ec008c, #fc6767); box-shadow: 0 4px 15px rgba(236, 0, 140, 0.3); }
        .dbd { background: linear-gradient(135deg, #2193b0, #6dd5ed); box-shadow: 0 4px 15px rgba(33, 147, 176, 0.3); }

        /* MODAL STYLES */
        .modal-overlay {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            
            background: rgba(15, 23, 42, 0); 
            backdrop-filter: blur(0px);
            
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            padding: 20px;

            opacity: 0;
            visibility: hidden;
            pointer-events: none;
            transition: all 0.4s ease;
        }

        .modal-overlay.active { 
            opacity: 1;
            visibility: visible;
            pointer-events: auto;
            background: rgba(15, 23, 42, 0.6); 
            backdrop-filter: blur(8px);
        }

        .modal {
            background: white;
            border-radius: 24px;
            padding: 30px;
            max-width: 380px;
            width: 100%;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            transform: translateY(20px) scale(0.95);
            opacity: 0;
            transition: all 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        .modal-overlay.active .modal {
            transform: translateY(0) scale(1);
            opacity: 1;
        }

        .modal-icon {
            width: 70px;
            height: 70px;
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px;
            font-size: 28px;
            color: white;
        }

        .modal h2 { text-align: center; margin-bottom: 10px; color: var(--text-dark); }
        .modal p { text-align: center; color: var(--text-light); margin-bottom: 25px; }
        
        .modal-actions { display: flex; gap: 12px; }

        .modal-btn {
            padding: 12px 0;
            border-radius: 12px;
            border: none;
            font-weight: 600;
            cursor: pointer;
            flex: 1;
            font-size: 0.95rem;
            transition: 0.2s;
            user-select: none;
            -webkit-user-select: none;
            -webkit-tap-highlight-color: transparent;
            outline: none;
        }

        .modal-btn:focus { outline: none; }
        .modal-btn.cancel { background: #f1f5f9; color: #64748b; }
        .modal-btn.confirm { background: #0f172a; color: white; }
        .modal-btn:active { transform: scale(0.96); }

        /* FOOTER */
        .footer {
            text-align: center;
            color: var(--text-light);
            font-size: 0.85rem;
            margin-top: 20px;
            font-weight: 500;
        }

        /* RESPONSIVE */
        @media (max-width: 768px) {
            .header-wrapper { padding: 30px 20px 70px 20px; border-radius: 0 0 25px 25px; }
            .header h1 { font-size: 2rem; }
            .menu-grid { grid-template-columns: repeat(3, 1fr); gap: 15px; }
        }

        @media (max-width: 600px) {
            body { padding: 0 0 20px 0; }
            .header-wrapper { border-radius: 0 0 20px 20px; margin-bottom: -30px; }
            .container { padding: 0 15px; }
            .menu-grid { grid-template-columns: repeat(2, 1fr); gap: 12px; }
            .health-card { padding: 15px 10px; }
            .card-icon { width: 45px; height: 45px; font-size: 20px; border-radius: 12px; }
            .card-content h3 { font-size: 0.9rem; }
            .card-content p { font-size: 0.7rem; }
        }
        
        @media (max-width: 350px) {
            .menu-grid { grid-template-columns: 1fr; }
        }

        .no-results {
            grid-column: 1 / -1;
            text-align: center;
            padding: 40px;
            background: white;
            border-radius: 20px;
            color: var(--text-light);
            box-shadow: var(--shadow-card);
        }
    </style>
</head>
<body>

    <div class="splash-screen" id="splashScreen">
        <div class="splash-content">
            <div class="splash-icon-box">
                <i class="fas fa-heartbeat splash-icon"></i>
            </div>
            <div class="splash-title">KASUR</div>
            <div class="splash-subtitle">Kampung Surveilans</div>
            
            <div class="loading-dots">
                <div class="dot"></div>
                <div class="dot"></div>
                <div class="dot"></div>
            </div>
        </div>
    </div>

    <div class="install-banner" id="installBanner">
        <div class="close-install" id="closeInstall">x</div>
        <div class="install-content">
            <div class="install-icon">
                <i class="fas fa-download"></i>
            </div>
            <div class="install-text">
                <h4>Install Aplikasi KASUR</h4>
                <p>Akses lebih cepat dari Homescreen</p>
            </div>
        </div>
        <button class="install-btn" id="installBtn">Pasang</button>
    </div>

    <div class="header-wrapper">
        <div class="header-bg-circle circle-1"></div>
        <div class="header-bg-circle circle-2"></div>
        
        <div class="container header-content">
            <header class="header">
                <h1>KAMPUNG SURVEILANS</h1>
                <p>Dirancang oleh UPT Puskesmas Kampung Dalam</p>
            </header>
        </div>
    </div>

    <div class="container">
        <div class="search-container">
            <div class="search-box">
                <i class="fas fa-search"></i>
                <input type="text" id="searchInput" placeholder="Cari nama penyakit...">
            </div>
        </div>

        <main class="menu-grid" id="menuGrid">
            <div class="health-card" data-disease="Campak/Rubella" data-color="campak" data-search="campak rubella measles" data-url="campak.html">
                <div class="card-icon campak"><i class="fas fa-virus"></i></div>
                <div class="card-content">
                    <h3>Campak/Rubella</h3>
                    <p>Infeksi virus menular dengan ruam merah.</p>
                </div>
            </div>

            <div class="health-card" data-disease="Difteri" data-color="difteri" data-search="difteri diphtheria" data-url="difteri.html">
                <div class="card-icon difteri"><i class="fas fa-lungs-virus"></i></div>
                <div class="card-content">
                    <h3>Difteri</h3>
                    <p>Infeksi bakteri pada selaput lendir hidung/tenggorokan.</p>
                </div>
            </div>

            <div class="health-card" data-disease="AFP" data-color="afp" data-search="afp acute flaccid paralysis polio kelumpuhan" data-url="afp.html">
                <div class="card-icon afp"><i class="fas fa-procedures"></i></div>
                <div class="card-content">
                    <h3>AFP</h3>
                    <p>Kelumpuhan mendadak indikator surveilans polio.</p>
                </div>
            </div>

            <div class="health-card" data-disease="Tetanus Neonatorum" data-color="tetanus" data-search="tetanus neonatorum kejang bayi" data-url="tetanus.html">
                <div class="card-icon tetanus"><i class="fas fa-baby"></i></div>
                <div class="card-content">
                    <h3>Tetanus Neonatorum</h3>
                    <p>Infeksi pada bayi baru lahir menyebabkan kejang.</p>
                </div>
            </div>

            <div class="health-card" data-disease="Pertusis" data-color="pertusis" data-search="pertusis batuk rejan whooping cough" data-url="pertusis.html">
                <div class="card-icon pertusis"><i class="fas fa-head-side-cough"></i></div>
                <div class="card-content">
                    <h3>Pertusis</h3>
                    <p>Batuk rejan atau infeksi saluran pernapasan hebat.</p>
                </div>
            </div>

            <div class="health-card" data-disease="DBD" data-color="dbd" data-search="dbd demam berdarah dengue nyamuk" data-url="dbd.html">
                <div class="card-icon dbd"><i class="fas fa-mosquito"></i></div>
                <div class="card-content">
                    <h3>DBD</h3>
                    <p>Demam berdarah dengue akibat gigitan nyamuk Aedes.</p>
                </div>
            </div>
        </main>

        <footer class="footer">
            <p>UPT Puskesmas Kampung Dalam Â© 2026</p>
        </footer>
    </div>

    <div class="modal-overlay" id="modalOverlay">
        <div class="modal" id="modal">
            <div class="modal-icon" id="modalIcon"></div>
            <h2 id="modalTitle">Konfirmasi</h2>
            <p id="modalMessage">Pesan konfirmasi.</p>
            <div class="modal-actions">
                <button class="modal-btn cancel" id="cancelBtn">Batal</button>
                <button class="modal-btn confirm" id="confirmBtn">Buka</button>
            </div>
        </div>
    </div>

    <script>
        // --- 1. REGISTER VIRTUAL SERVICE WORKER FOR PWA INSTALLABILITY ---
        if ('serviceWorker' in navigator) {
            // Kita membuat service worker minimal secara on-the-fly agar memenuhi syarat 'Add to Homescreen'
            // tanpa perlu file sw.js eksternal.
            const swContent = `
                self.addEventListener('install', (e) => {
                    console.log('[SW] Install');
                    self.skipWaiting();
                });
                self.addEventListener('fetch', (e) => {
                    // Caching strategy bisa ditambahkan di sini, tapi untuk sekarang kita bypass
                    e.respondWith(fetch(e.request));
                });
            `;
            const blob = new Blob([swContent], {type: 'text/javascript'});
            const swUrl = URL.createObjectURL(blob);
            
            navigator.serviceWorker.register(swUrl)
                .then(reg => console.log('SW Registered', reg))
                .catch(err => console.log('SW Failed', err));
        }

        // --- 2. UPDATE MANIFEST DYNAMICALLY (Fix Icon Data URI) ---
        // Karena manifest Data URI panjang, kita pastikan icon yg benar dipakai
        const iconLink = document.querySelector("link[rel='icon']").href;
        const manifestLink = document.getElementById('manifestLink');
        // Decode base64 manifest lama, update icon, encode ulang
        let manifestBase64 = manifestLink.href.replace('data:application/manifest+json;base64,', '');
        try {
            let manifestJson = JSON.parse(atob(manifestBase64));
            // Update icon di manifest agar sama dengan link icon terbaru
            manifestJson.icons = [{
                "src": iconLink,
                "type": "image/svg+xml",
                "sizes": "144x144 192x192 512x512",
                "purpose": "any maskable"
            }];
            manifestJson.name = "KASUR (Kampung Surveilans)";
            manifestJson.short_name = "KASUR";
            
            const newBase64 = btoa(JSON.stringify(manifestJson));
            manifestLink.href = 'data:application/manifest+json;base64,' + newBase64;
        } catch (e) { console.error("Manifest update error", e); }


        document.addEventListener('DOMContentLoaded', function() {
            // --- 3. SPLASH SCREEN LOGIC & DOUBLE SPLASH FIX ---
            const splashScreen = document.getElementById('splashScreen');
            
            // Cek apakah aplikasi berjalan dalam mode Standalone (Sudah diinstall)
            const isStandalone = window.matchMedia('(display-mode: standalone)').matches || window.navigator.standalone === true;

            if (isStandalone) {
                // JIKA APLIKASI SUDAH DIINSTALL:
                // Sembunyikan splash screen HTML segera! Karena HP sudah menampilkan native splash screen.
                // Ini mencegah efek "Double Splash Screen".
                splashScreen.style.display = 'none';
                document.body.classList.add('loaded');
                
                // Pastikan kartu-kartu langsung muncul tanpa animasi delay
                const cards = document.querySelectorAll('.health-card');
                cards.forEach(card => {
                    card.style.opacity = '1';
                    card.style.transform = 'translateY(0)';
                });

            } else {
                // JIKA DI BROWSER:
                // Tampilkan animasi splash screen normal
                setTimeout(() => {
                    splashScreen.classList.add('hide');
                    document.body.classList.add('loaded'); // Aktifkan scroll kembali
                }, 3000);

                // Animasi Masuk Kartu
                const cards = document.querySelectorAll('.health-card');
                setTimeout(() => {
                    cards.forEach((card, index) => {
                        card.style.opacity = '0';
                        setTimeout(() => {
                            card.style.opacity = '1';
                            card.style.transform = 'translateY(0)';
                        }, 100 * index);
                    });
                }, 2800);
            }

            // --- 4. INSTALL PROMPT LOGIC ---
            let deferredPrompt;
            const installBanner = document.getElementById('installBanner');
            const installBtn = document.getElementById('installBtn');
            const closeInstall = document.getElementById('closeInstall');

            window.addEventListener('beforeinstallprompt', (e) => {
                // Mencegah browser menampilkan prompt default mini-infobar
                e.preventDefault();
                // Simpan event untuk ditrigger nanti
                deferredPrompt = e;
                
                // Tampilkan banner instalasi kita yang keren
                // Delay sedikit agar tidak menabrak splash screen
                if (!isStandalone) {
                    setTimeout(() => {
                        installBanner.classList.add('show');
                    }, 4000);
                }
            });

            installBtn.addEventListener('click', async () => {
                if (deferredPrompt) {
                    installBanner.classList.remove('show');
                    // Tampilkan prompt asli browser
                    deferredPrompt.prompt();
                    // Tunggu respon user
                    const { outcome } = await deferredPrompt.userChoice;
                    console.log(`User response: ${outcome}`);
                    deferredPrompt = null;
                }
            });

            closeInstall.addEventListener('click', () => {
                installBanner.classList.remove('show');
            });


            // --- MAIN APP LOGIC (Search & Modal) ---
            const searchInput = document.getElementById('searchInput');
            const menuGrid = document.getElementById('menuGrid');
            const modalOverlay = document.getElementById('modalOverlay');
            const cards = document.querySelectorAll('.health-card'); // Re-select
            
            let targetUrl = '';

            // Logic Pencarian
            function filterCards() {
                const term = searchInput.value.toLowerCase().trim();
                let hasResults = false;
                const existingMsg = document.querySelector('.no-results');
                if(existingMsg) existingMsg.remove();

                cards.forEach(card => {
                    const searchData = card.getAttribute('data-search').toLowerCase();
                    const title = card.querySelector('h3').textContent.toLowerCase();
                    
                    if (searchData.includes(term) || title.includes(term)) {
                        card.style.display = 'flex';
                        hasResults = true;
                    } else {
                        card.style.display = 'none';
                    }
                });

                if (!hasResults && term !== '') {
                    const noResults = document.createElement('div');
                    noResults.className = 'no-results';
                    noResults.innerHTML = `<i class="fas fa-folder-open" style="font-size: 32px; opacity: 0.3; margin-bottom: 10px; color:var(--text-dark)"></i><p>Data tidak ditemukan</p>`;
                    menuGrid.appendChild(noResults);
                }
            }

            searchInput.addEventListener('input', filterCards);

            // Logic Modal
            function showModal(card) {
                const disease = card.getAttribute('data-disease');
                const color = card.getAttribute('data-color');
                targetUrl = card.getAttribute('data-url');
                
                const iconHTML = card.querySelector('.card-icon').innerHTML;
                const modalIcon = document.getElementById('modalIcon');
                
                // Reset class dan tambahkan class warna baru
                modalIcon.className = 'modal-icon ' + color;
                modalIcon.innerHTML = iconHTML;
                
                document.getElementById('modalTitle').textContent = disease;
                document.getElementById('modalMessage').textContent = `Buka formulir pelaporan untuk ${disease}?`;
                
                modalOverlay.classList.add('active');
            }

            cards.forEach(card => {
                card.addEventListener('click', function(e) {
                    e.preventDefault();
                    showModal(this);
                });
            });

            document.getElementById('cancelBtn').addEventListener('click', () => modalOverlay.classList.remove('active'));
            
            // Logic Tombol Buka
            document.getElementById('confirmBtn').addEventListener('click', () => {
                modalOverlay.classList.remove('active');
                if (targetUrl) {
                    setTimeout(() => {
                        window.location.href = targetUrl;
                    }, 150);
                }
            });

            modalOverlay.addEventListener('click', (e) => {
                if (e.target === modalOverlay) modalOverlay.classList.remove('active');
            });
        });
    </script>
</body>
</html>
